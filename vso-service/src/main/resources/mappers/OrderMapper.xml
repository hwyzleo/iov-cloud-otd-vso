<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="net.hwyz.iov.cloud.otd.vso.service.infrastructure.repository.dao.OrderDao">

    <!-- 通用查询映射结果 -->
    <resultMap id="baseResultMap" type="net.hwyz.iov.cloud.otd.vso.service.infrastructure.repository.po.OrderPo">
        <id column="id" property="id" />
        <result column="description" property="description" />
        <result column="create_time" property="createTime" />
        <result column="create_by" property="createBy" />
        <result column="modify_time" property="modifyTime" />
        <result column="modify_by" property="modifyBy" />
        <result column="row_version" property="rowVersion" />
        <result column="row_valid" property="rowValid" />
        <result column="order_num" property="orderNum" />
        <result column="order_state" property="orderState" />
        <result column="sale_code" property="saleCode" />
        <result column="model_config_code" property="modelConfigCode" />
        <result column="model_config_lock" property="modelConfigLock" />
        <result column="pay_state" property="payState" />
        <result column="order_type" property="orderType" />
        <result column="order_person_id" property="orderPersonId" />
        <result column="order_person_name" property="orderPersonName" />
        <result column="order_person_phone" property="orderPersonPhone" />
        <result column="recommender_id" property="recommenderId" />
        <result column="contact_person_name" property="contactPersonName" />
        <result column="contact_person_phone" property="contactPersonPhone" />
        <result column="sales_person_id" property="salesPersonId" />
        <result column="sales_person_name" property="salesPersonName" />
        <result column="sales_person_phone" property="salesPersonPhone" />
        <result column="sales_person_order" property="salesPersonOrder" />
        <result column="sales_channel" property="salesChannel" />
        <result column="buy_plan" property="buyPlan" />
        <result column="delivery_city" property="deliveryCity" />
        <result column="delivery_method" property="deliveryMethod" />
        <result column="delivery_person_id" property="deliveryPersonId" />
        <result column="delivery_person_name" property="deliveryPersonName" />
        <result column="delivery_remark" property="deliveryRemark" />
        <result column="reception_person_id" property="receptionPersonId" />
        <result column="reception_person_name" property="receptionPersonName" />
        <result column="invoicing_time" property="invoicingTime" />
        <result column="estimated_delivery_time" property="estimatedDeliveryTime" />
        <result column="actual_delivery_time" property="actualDeliveryTime" />
        <result column="license_city" property="licenseCity" />
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="baseColumnList">
        id, order_num, order_state, sale_code, model_config_code, model_config_lock, pay_state, order_type, order_person_id, order_person_name, order_person_phone, recommender_id, contact_person_name, contact_person_phone, sales_person_id, sales_person_name, sales_person_phone, sales_person_order, sales_channel, buy_plan, delivery_city, delivery_method, delivery_person_id, delivery_person_name, delivery_remark, reception_person_id, reception_person_name, invoicing_time, estimated_delivery_time, actual_delivery_time, license_city, 
        description, create_time, create_by, modify_time, modify_by, row_version, row_valid
    </sql>

    <!-- 插入 -->
    <insert id="insertPo" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO tb_order (
            id, order_num, order_state, sale_code, model_config_code, model_config_lock, pay_state, order_type, order_person_id, order_person_name, order_person_phone, recommender_id, contact_person_name, contact_person_phone, sales_person_id, sales_person_name, sales_person_phone, sales_person_order, sales_channel, buy_plan, delivery_city, delivery_method, delivery_person_id, delivery_person_name, delivery_remark, reception_person_id, reception_person_name, invoicing_time, estimated_delivery_time, actual_delivery_time, license_city, 
            description, create_time, create_by, modify_time, modify_by, row_version, row_valid
        )
        VALUES (
            #{id}, #{orderNum}, #{orderState}, #{saleCode}, #{modelConfigCode}, #{modelConfigLock}, #{payState}, #{orderType}, #{orderPersonId}, #{orderPersonName}, #{orderPersonPhone}, #{recommenderId}, #{contactPersonName}, #{contactPersonPhone}, #{salesPersonId}, #{salesPersonName}, #{salesPersonPhone}, #{salesPersonOrder}, #{salesChannel}, #{buyPlan}, #{deliveryCity}, #{deliveryMethod}, #{deliveryPersonId}, #{deliveryPersonName}, #{deliveryRemark}, #{receptionPersonId}, #{receptionPersonName}, #{invoicingTime}, #{estimatedDeliveryTime}, #{actualDeliveryTime}, #{licenseCity}, 
            #{description}, now(), #{createBy}, now(), #{modifyBy}, 1, 1
        )
    </insert>

    <!-- 批量插入 -->
    <insert id="batchInsertPo" useGeneratedKeys="true" keyProperty="id" parameterType="java.util.List">
        INSERT INTO tb_order (
            id, order_num, order_state, sale_code, model_config_code, model_config_lock, pay_state, order_type, order_person_id, order_person_name, order_person_phone, recommender_id, contact_person_name, contact_person_phone, sales_person_id, sales_person_name, sales_person_phone, sales_person_order, sales_channel, buy_plan, delivery_city, delivery_method, delivery_person_id, delivery_person_name, delivery_remark, reception_person_id, reception_person_name, invoicing_time, estimated_delivery_time, actual_delivery_time, license_city, 
            description, create_time, create_by, modify_time, modify_by, row_version, row_valid
        )
        VALUES
        <foreach collection="list" item="item" index="index" separator=",">
        (
            #{item.id}, #{item.orderNum}, #{item.orderState}, #{item.saleCode}, #{item.modelConfigCode}, #{item.modelConfigLock}, #{item.payState}, #{item.orderType}, #{item.orderPersonId}, #{item.orderPersonName}, #{item.orderPersonPhone}, #{item.recommenderId}, #{item.contactPersonName}, #{item.contactPersonPhone}, #{item.salesPersonId}, #{item.salesPersonName}, #{item.salesPersonPhone}, #{item.salesPersonOrder}, #{item.salesChannel}, #{item.buyPlan}, #{item.deliveryCity}, #{item.deliveryMethod}, #{item.deliveryPersonId}, #{item.deliveryPersonName}, #{item.deliveryRemark}, #{item.receptionPersonId}, #{item.receptionPersonName}, #{item.invoicingTime}, #{item.estimatedDeliveryTime}, #{item.actualDeliveryTime}, #{item.licenseCity}, 
            #{item.description}, now(), #{item.createBy}, now(), #{item.modifyBy}, 1, 1
        )
        </foreach>
    </insert>

    <!-- 更新 -->
    <update id="updatePo" parameterType="net.hwyz.iov.cloud.otd.vso.service.infrastructure.repository.po.OrderPo">
        UPDATE tb_order t SET
        <if test="orderState != null">
            t.order_state = #{orderState},
        </if>
        <if test="saleCode != null and saleCode != ''">
            t.sale_code = #{saleCode},
        </if>
        <if test="modelConfigCode != null and modelConfigCode != ''">
            t.model_config_code = #{modelConfigCode},
        </if>
        <if test="modelConfigLock != null">
            t.model_config_lock = #{modelConfigLock},
        </if>
        <if test="payState != null">
            t.pay_state = #{payState},
        </if>
        <if test="orderType != null">
            t.order_type = #{orderType},
        </if>
        <if test="orderPersonId != null and orderPersonId != ''">
            t.order_person_id = #{orderPersonId},
        </if>
        <if test="orderPersonName != null and orderPersonName != ''">
            t.order_person_name = #{orderPersonName},
        </if>
        <if test="orderPersonPhone != null and orderPersonPhone != ''">
            t.order_person_phone = #{orderPersonPhone},
        </if>
        <if test="recommenderId != null and recommenderId != ''">
            t.recommender_id = #{recommenderId},
        </if>
        <if test="contactPersonName != null and contactPersonName != ''">
            t.contact_person_name = #{contactPersonName},
        </if>
        <if test="contactPersonPhone != null and contactPersonPhone != ''">
            t.contact_person_phone = #{contactPersonPhone},
        </if>
        <if test="salesPersonId != null and salesPersonId != ''">
            t.sales_person_id = #{salesPersonId},
        </if>
        <if test="salesPersonName != null and salesPersonName != ''">
            t.sales_person_name = #{salesPersonName},
        </if>
        <if test="salesPersonPhone != null and salesPersonPhone != ''">
            t.sales_person_phone = #{salesPersonPhone},
        </if>
        <if test="salesPersonOrder != null">
            t.sales_person_order = #{salesPersonOrder},
        </if>
        <if test="salesChannel != null and salesChannel != ''">
            t.sales_channel = #{salesChannel},
        </if>
        <if test="buyPlan != null and buyPlan != ''">
            t.buy_plan = #{buyPlan},
        </if>
        <if test="deliveryCity != null and deliveryCity != ''">
            t.delivery_city = #{deliveryCity},
        </if>
        <if test="deliveryMethod != null and deliveryMethod != ''">
            t.delivery_method = #{deliveryMethod},
        </if>
        <if test="deliveryPersonId != null and deliveryPersonId != ''">
            t.delivery_person_id = #{deliveryPersonId},
        </if>
        <if test="deliveryPersonName != null and deliveryPersonName != ''">
            t.delivery_person_name = #{deliveryPersonName},
        </if>
        <if test="deliveryRemark != null and deliveryRemark != ''">
            t.delivery_remark = #{deliveryRemark},
        </if>
        <if test="receptionPersonId != null and receptionPersonId != ''">
            t.reception_person_id = #{receptionPersonId},
        </if>
        <if test="receptionPersonName != null and receptionPersonName != ''">
            t.reception_person_name = #{receptionPersonName},
        </if>
        <if test="invoicingTime != null">
            t.invoicing_time = #{invoicingTime},
        </if>
        <if test="estimatedDeliveryTime != null">
            t.estimated_delivery_time = #{estimatedDeliveryTime},
        </if>
        <if test="actualDeliveryTime != null">
            t.actual_delivery_time = #{actualDeliveryTime},
        </if>
        <if test="licenseCity != null and licenseCity != ''">
            t.license_city = #{licenseCity},
        </if>
        <if test="description != null and description != ''">
            t.description = #{description},
        </if>
        <if test="modifyBy != null">
            t.modify_by = #{modifyBy},
        </if>
        t.row_version = t.row_version + 1,
        t.modify_time = now()
        WHERE order_num = #{orderNum}
    </update>

    <!-- 逻辑删除 -->
    <update id="logicalDeletePo" parameterType="Long">
        UPDATE tb_order t SET
        t.row_version = t.row_version + 1,
        t.modify_time = now(),
        t.row_valid = 0
        WHERE t.id = #{value}
    </update>

    <!-- 物理删除 -->
    <delete id="physicalDeletePo" parameterType="Long">
        DELETE FROM tb_order t
        WHERE t.id = #{value}
    </delete>

    <!-- 根据订单编号删除订单 -->
    <delete id="physicalDeletePoByOrderNum" parameterType="string">
        DELETE FROM tb_order t
        WHERE t.order_num = #{value}
    </delete>

    <!-- 根据主键获取对应数据 -->
    <select id="selectPoById" parameterType="Long" resultMap="baseResultMap">
        SELECT <include refid="baseColumnList"/>
        FROM tb_order t
        WHERE t.id = #{value}
        AND t.row_valid = 1
    </select>

    <!-- 根据数据对象获取对应数据列表 -->
    <select id="selectPoByExample" parameterType="net.hwyz.iov.cloud.otd.vso.service.infrastructure.repository.po.OrderPo" resultMap="baseResultMap">
        SELECT <include refid="baseColumnList"/>
        FROM tb_order t
        WHERE t.row_valid = 1
        <if test="id != null">
            AND t.id = #{id}
        </if>
        <if test="orderNum != null and orderNum != ''">
            AND t.order_num = #{orderNum}
        </if>
        <if test="orderState != null">
            AND t.order_state = #{orderState}
        </if>
        <if test="saleCode != null and saleCode != ''">
            AND t.sale_code = #{saleCode}
        </if>
        <if test="modelConfigCode != null and modelConfigCode != ''">
            AND t.model_config_code = #{modelConfigCode}
        </if>
        <if test="modelConfigLock != null">
            AND t.model_config_lock = #{modelConfigLock}
        </if>
        <if test="payState != null">
            AND t.pay_state = #{payState}
        </if>
        <if test="orderType != null">
            AND t.order_type = #{orderType}
        </if>
        <if test="orderPersonId != null and orderPersonId != ''">
            AND t.order_person_id = #{orderPersonId}
        </if>
        <if test="orderPersonName != null and orderPersonName != ''">
            AND t.order_person_name = #{orderPersonName}
        </if>
        <if test="orderPersonPhone != null and orderPersonPhone != ''">
            AND t.order_person_phone = #{orderPersonPhone}
        </if>
        <if test="recommenderId != null and recommenderId != ''">
            AND t.recommender_id = #{recommenderId}
        </if>
        <if test="contactPersonName != null and contactPersonName != ''">
            AND t.contact_person_name = #{contactPersonName}
        </if>
        <if test="contactPersonPhone != null and contactPersonPhone != ''">
            AND t.contact_person_phone = #{contactPersonPhone}
        </if>
        <if test="salesPersonId != null and salesPersonId != ''">
            AND t.sales_person_id = #{salesPersonId}
        </if>
        <if test="salesPersonName != null and salesPersonName != ''">
            AND t.sales_person_name = #{salesPersonName}
        </if>
        <if test="salesPersonPhone != null and salesPersonPhone != ''">
            AND t.sales_person_phone = #{salesPersonPhone}
        </if>
        <if test="salesPersonOrder != null">
            AND t.sales_person_order = #{salesPersonOrder}
        </if>
        <if test="salesChannel != null and salesChannel != ''">
            AND t.sales_channel = #{salesChannel}
        </if>
        <if test="buyPlan != null and buyPlan != ''">
            AND t.buy_plan = #{buyPlan}
        </if>
        <if test="deliveryCity != null and deliveryCity != ''">
            AND t.delivery_city = #{deliveryCity}
        </if>
        <if test="deliveryMethod != null and deliveryMethod != ''">
            AND t.delivery_method = #{deliveryMethod}
        </if>
        <if test="deliveryPersonId != null and deliveryPersonId != ''">
            AND t.delivery_person_id = #{deliveryPersonId}
        </if>
        <if test="deliveryPersonName != null and deliveryPersonName != ''">
            AND t.delivery_person_name = #{deliveryPersonName}
        </if>
        <if test="deliveryRemark != null and deliveryRemark != ''">
            AND t.delivery_remark = #{deliveryRemark}
        </if>
        <if test="receptionPersonId != null and receptionPersonId != ''">
            AND t.reception_person_id = #{receptionPersonId}
        </if>
        <if test="receptionPersonName != null and receptionPersonName != ''">
            AND t.reception_person_name = #{receptionPersonName}
        </if>
        <if test="invoicingTime != null">
            AND t.invoicing_time = #{invoicingTime}
        </if>
        <if test="estimatedDeliveryTime != null">
            AND t.estimated_delivery_time = #{estimatedDeliveryTime}
        </if>
        <if test="actualDeliveryTime != null">
            AND t.actual_delivery_time = #{actualDeliveryTime}
        </if>
        <if test="licenseCity != null and licenseCity != ''">
            AND t.license_city = #{licenseCity}
        </if>
        <if test="description != null and description != ''">
            AND t.description = #{description}
        </if>
        <if test="createTime != null">
            AND t.create_time = #{createTime}
        </if>
        <if test="createBy != null">
            AND t.create_by = #{createBy}
        </if>
        <if test="modifyTime != null">
            AND t.modify_time = #{modifyTime}
        </if>
        <if test="modifyBy != null">
            AND t.modify_by = #{modifyBy}
        </if>
        <if test="rowVersion != null">
            AND t.row_version = #{rowVersion}
        </if>
        ORDER BY t.id DESC
    </select>

    <!-- 根据Map对象获取对应数据列表 -->
    <select id="selectPoByMap" parameterType="java.util.Map" resultMap="baseResultMap">
        SELECT <include refid="baseColumnList"/>
        FROM tb_order t
        WHERE t.row_valid = 1
        <!-- 添加自定义条件 -->
        <if test="orderPersonId != null and orderPersonId != ''">
            AND t.order_person_id = #{orderPersonId}
        </if>
        <if test="stateValid != null and stateValid = 1">
            AND t.order_state != 950
        </if>
        ORDER BY t.id DESC
    </select>

    <!-- 根据Map对象统计记录数 -->
    <select id="countPoByMap" parameterType="java.util.Map" resultType="int">
        SELECT COUNT(*)
        FROM tb_order t
        WHERE t.row_valid = 1
        <!-- 添加自定义条件 -->
    </select>
</mapper>
